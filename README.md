# RAG Chat Storage Microservice

![Build](https://img.shields.io/badge/build-passing-brightgreen)
![Docker](https://img.shields.io/badge/docker-ready-blue)
![Swagger](https://img.shields.io/badge/swagger-documented-orange)
![License](https://img.shields.io/badge/license-MIT-lightgrey)

## Overview
This microservice stores and manages chat histories generated by a **RAG (Retrieval-Augmented Generation) based chatbot** system.  
It provides APIs to manage chat sessions and messages, supporting features like session creation, renaming, marking favorite, deletion, and message retrieval.  
The service is built using **Spring Boot (Java 17)**, **PostgreSQL**, and follows a microservices architecture with performance, security, and scalability in mind.

---

## Features
- Start and maintain chat sessions for users.
- Save messages within a session (sender, content, optional context).
- Rename chat sessions.
- Mark/unmark sessions as favorite.
- Delete chat sessions and their messages.
- Retrieve the message history of a chat session.
- **API Key Authentication** for all endpoints.
- Rate limiting to prevent abuse.
- Centralized logging and global exception handling.
- Multi-environment configuration (`dev`, `pre-sit`, `sit`).
- Dockerized for easy deployment.
- Swagger/OpenAPI documentation for all APIs.

---

## Technologies
- **Backend:** Java 17, Spring Boot, Hibernate (JPA)
- **Database:** PostgreSQL 15+
- **Database Migrations:** Flyway
- **Security:** API Key Authentication, session isolation
- **Rate Limiting:** Bucket4j / Guava
- **Logging:** SLF4J / Logback
- **Build Tool:** Gradle
- **Documentation:** Swagger / Springdoc OpenAPI
- **Containerization:** Docker, Docker Compose
- **Version Control:** Git / GitHub

---

## Project Structure

rag-chat-storage/
├── build.gradle
├── settings.gradle
├── Dockerfile
├── docker-compose.yml
├── .env # Database credentials and environment variables
├── src/main/java/com/example/ragchat
│ ├── config/ # Security, CORS, Swagger, APIKey configuration
│ ├── controller/ # REST Controllers
│ ├── dto/ # Request & Response DTOs
│ ├── service/
│ │ ├── impl/ # Service Implementations
│ ├── model/ # JPA Entities
│ ├── repository/ # Spring Data JPA Repositories
│ ├── exception/ # Custom exceptions & Global handler
│ ├── util/ # Helpers (logging, rate limiting)
│ └── RagChatApplication.java
│
├── src/main/resources/
│ ├── application.yml
│ ├── application-dev.yml
│ ├── application-pre-sit.yml
│ ├── application-sit.yml
│ └── db/migration/ # Flyway migration SQL files (PostgreSQL compatible)

sql
Copy code

---

## Database Schema

### chat_sessions
| Column      | Type      | Notes                               |
|------------|-----------|------------------------------------|
| id         | BIGINT    | Primary Key, Auto Increment        |
| user_id    | BIGINT    | ID of the user owning the session |
| name       | VARCHAR   | Session name, unique per user      |
| is_favorite| BOOLEAN   | Default FALSE                      |
| created_at | TIMESTAMP | Auto set on creation               |
| updated_at | TIMESTAMP | Auto updated on modification       |

### chat_messages
| Column      | Type       | Notes                               |
|------------|------------|------------------------------------|
| id         | BIGINT     | Primary Key, Auto Increment        |
| session_id | BIGINT     | Foreign Key → chat_sessions(id)    |
| sender     | ENUM       | 'USER' or 'AI'                     |
| content    | TEXT       | Message content                     |
| context    | JSON       | Optional context                     |
| created_at | TIMESTAMP  | Auto set on creation                |

### Optional users table
| Column        | Type       | Notes                         |
|---------------|------------|-------------------------------|
| id            | BIGINT     | Primary Key, Auto Increment  |
| username      | VARCHAR    | Unique                       |
| email         | VARCHAR    | Unique                       |
| password_hash | VARCHAR    | Hashed password              |
| created_at    | TIMESTAMP  | Auto set on creation         |

---

## Setup Instructions

### 1. Clone the Repository
```bash
git clone https://github.com/ahadmughal/rag-chat-history.git

2. Configure Environment
Create a .env file at the project root:

env
Copy code
POSTGRES_DB=rag_chat_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/rag_chat_db
SPRING_DATASOURCE_USERNAME=postgres
SPRING_DATASOURCE_PASSWORD=postgres
SPRING_JPA_HIBERNATE_DDL_AUTO=none
SPRING_FLYWAY_ENABLED=true
3. Build the Application
bash
Copy code
./gradlew clean build
4. Run with Docker Compose
bash
Copy code
docker compose up --build
PostgreSQL runs on port 5432

Adminer (web UI) runs on port 8080

App runs on port 8989

You can access Adminer at: http://localhost:8080

System: PostgreSQL

Server: postgres

Username: postgres

Password: postgres

Database: rag_chat_db

5. API Documentation
Swagger UI: http://localhost:8989/swagger-ui.html

6. Notes
API Key Authentication: All endpoints require a valid API key.

Session Isolation: Users can only access their own chat sessions.

Rate Limiting: Prevents abuse of APIs.

Multi-environment support via application-dev.yml, application-pre-sit.yml, application-sit.yml.

Dockerized app ensures setup is simplified — users only need gradlew build and docker compose up --build.

Author
Abdul Ahad
Backend Developer | Java 17 | Spring Boot | Microservices